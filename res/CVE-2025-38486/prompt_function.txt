1. CVE Identifier
CVE-2025-38486

2. Vulnerability Type
Out-of-bounds write due to incorrect indexing and missing bounds validation; state corruption from overlapping data writes.

3. Root Cause Summary
The pre-patch qcom_swrm_set_channel_map function wrote channel masks into ctrl->pconfig[] starting at index 0 and iterating up to tx_num/rx_num without validating array bounds. Element 0 of ctrl->pconfig[] is reserved/unused, but the code still wrote to it (off-by-one start index). The function did not cap writes to the size of ctrl->pconfig[] (QCOM_SDW_MAX_PORTS + 1), while tx_num could be SLIM_MAX_TX_PORTS (16), causing out-of-bounds writes. The same pconfig[] array was used for both TX and RX loops, so RX writes overwrote previously set TX values, corrupting driver state.

4. Kernel Subsystem Analysis
1) Affected Subsystem:
ASoC SoundWire Qualcomm controller driver (soundwire: qcom)

2) Pre-Patch Flaw:
qcom_swrm_set_channel_map used “for (i = 0; i < tx_num; i++) ctrl->pconfig[i].ch_mask = tx_slot[i];” (and similarly for RX) without:
- Starting from index 1 as required (element 0 is unused).
- Any bounds checks against ctrl->pconfig[] length (QCOM_SDW_MAX_PORTS + 1).
- Separation of TX and RX storage, causing RX writes to overwrite TX configuration.

3) Trigger Condition:
Invocation of snd_soc_dai_set_channel_map during ASoC card initialization (seen in the call trace via sdm845_dai_init → snd_soc_dai_set_channel_map), with tx_num/rx_num and slot arrays provided by the platform, including cases where tx_num == SLIM_MAX_TX_PORTS (16) and RX mapping also present.

4) Impact Mechanism:
- Out-of-bounds writes into ctrl->pconfig[] corrupt adjacent kernel memory, leading to a BRK exception and kernel panic (as observed on Dragonboard 845c).
- Overwriting TX configuration with RX values corrupts channel mapping state, potentially breaking audio routing and stability.

5. Patch Analysis
1) Fix Approach:
Full revert of the set_channel_map support, removing the flawed function and its registration from DAI ops to eliminate the unsafe path entirely.

2) Key Code Changes:
- Deleted qcom_swrm_set_channel_map implementation that wrote to ctrl->pconfig[] based on tx_slot/rx_slot.
- Removed .set_channel_map assignment from qcom_swrm_pdm_dai_ops, preventing calls to the removed function.

3) Locking/Concurrency Impact:
No locking changes; the issue was not concurrency-related. The revert removes unsafe memory writes, eliminating the corruption risk without affecting synchronization primitives.

6. Broader Kernel Security Implications
Unchecked indices and size mismatches in kernel drivers can produce exploitable memory corruption, not just crashes. Audio drivers must rigorously validate array bounds, respect reserved indices, and avoid overlapping buffers for different data directions (TX/RX). The revert mitigates immediate risk; any future reintroduction must include bounds checks, correct index start (1-based), and separate or properly indexed TX/RX mappings to preserve memory safety and system stability.