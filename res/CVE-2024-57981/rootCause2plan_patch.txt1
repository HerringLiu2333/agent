1. Plan Summary
Detect call sites that schedule the xHCI command timer (xhci_mod_cmd_timer) after assigning xhci->current_cmd from a possibly NULL source without first validating it is non-NULL.

2. Detection Steps
1) Step 1: Identify sinks — calls to xhci_mod_cmd_timer(xhci). Signals: function call where the callee is xhci_mod_cmd_timer and the argument is an xhci controller pointer.

2) Step 2: For each sink, find the most recent dominating assignment to xhci->current_cmd on the path to the call. Signals: field write of the form xhci->current_cmd = <source>, where <source> is a pointer-valued expression (typically a local/parameter like cur_cmd).

3) Step 3: Ensure there is no intervening write to xhci->current_cmd between that assignment and the sink. Signals: absence of any other assignment to xhci->current_cmd that post-dominates the prior write and dominates the sink.

4) Step 4: Determine whether a non-NULL guard exists for the source or the field before the sink. Signals: control flow test such as “if (source)” or “if (xhci->current_cmd)” that dominates the sink; or early return/continue on NULL.

5) Step 5: If no non-NULL guard is found, check whether the enclosing condition relies on unrelated state (e.g., ring pointer inequality or controller state) rather than validating the command pointer. Signals: conditions like (xhci->cmd_ring->dequeue != xhci->cmd_ring->enqueue) and !(xhci->xhc_state & XHCI_STATE_DYING) present in the same block, with no checks involving the source or xhci->current_cmd.

6) Step 6: Strengthen confidence by checking for the characteristic pre-patch sequence in xhci_handle_stopped_cmd_ring(). Signals: pattern “xhci->current_cmd = <source>; xhci_mod_cmd_timer(xhci); xhci_ring_cmd_db(xhci);” within the same block or closely adjacent statements.

7) Step 7: Confirm the sink’s dereference expectation based on known behavior. Signals: knowledge from the analysis that xhci_mod_cmd_timer operates on xhci->current_cmd and will dereference it, so it requires the field to be non-NULL.

8) Step 8: Flag a result when xhci_mod_cmd_timer is reachable after assigning xhci->current_cmd from an unvalidated source (no non-NULL check on the source or field along the path). Signals: dataflow from <source> to xhci->current_cmd to sink with no intervening non-NULL validation.

9) Step 9: De-duplicate reports within the same function and block, keeping the instance closest to the sink. Signals: same call site or same basic block occurrences.

3. Limitations & Assumptions
- Assumes xhci_mod_cmd_timer dereferences xhci->current_cmd as stated; the checker treats this function as requiring xhci->current_cmd to be non-NULL.
- Cannot prove at compile time that a specific source (e.g., cur_cmd) is NULL in a given execution; absence of a guarding non-NULL check is used as a proxy for potential NULL.
- Concurrency, timing, and hardware-driven state transitions (e.g., ring segment boundaries, abort completions) are not modeled; the checker focuses on static control/dataflow.
- The plan targets the xHCI context; generalization to other subsystems would require identifying analogous sink functions that dereference a field set from an unvalidated pointer.