1. CVE Identifier
CVE-2025-38281

2. Vulnerability Type
NULL pointer dereference due to missing allocation failure handling

3. Root Cause Summary
In mt7996_thermal_init, the driver constructs a device name with devm_kasprintf but does not validate the returned pointer before using it. If devm_kasprintf fails and returns NULL, the code passes this NULL “name” into thermal_cooling_device_register and later devm_hwmon_device_register_with_groups, leading to a kernel NULL pointer dereference. The patch adds the missing NULL check and returns -ENOMEM on failure, preventing unsafe use of the pointer.

4. Kernel Subsystem Analysis
1) Affected Subsystem:
MediaTek mt76 mt7996 Wi-Fi driver thermal/hwmon registration path (mt7996_thermal_init in the mt7996 driver)

2) Pre-Patch Flaw:
Unchecked return value from devm_kasprintf in mt7996_thermal_init. The code does “name = devm_kasprintf(&wiphy->dev, GFP_KERNEL, "mt7996_%s.%d", wiphy_name(wiphy), phy->mt76->band_idx);” and then immediately uses “name” in thermal_cooling_device_register(name, ...) and devm_hwmon_device_register_with_groups(&wiphy->dev, name, ...), without verifying that name is non-NULL.

3) Trigger Condition:
Memory allocation failure in devm_kasprintf (e.g., due to memory pressure) causing it to return NULL.

4) Impact Mechanism:
The NULL “name” argument is dereferenced in thermal_cooling_device_register and/or devm_hwmon_device_register_with_groups, resulting in a kernel NULL pointer dereference and system crash (denial of service) during device initialization.

5. Patch Analysis
1) Fix Approach:
Introduce an explicit NULL check after the devm_kasprintf call and return -ENOMEM when the allocation fails, aborting the thermal init sequence before any usage of the pointer.

2) Key Code Changes:
In mt7996_thermal_init:
- Added:
  if (!name)
      return -ENOMEM;
This guards subsequent calls that require a valid string (thermal_cooling_device_register and devm_hwmon_device_register_with_groups).

3) Locking/Concurrency Impact:
None. The patch only adds an early error return on allocation failure and does not change locking, ordering, or concurrency behavior.

6. Broader Kernel Security Implications
Ensuring allocation results are validated in driver initialization paths prevents straightforward kernel crashes under low-memory conditions, reducing denial-of-service risk. This change promotes safer use of devm_kasprintf and similar helpers and improves robustness of the thermal/hwmon integration in the Wi-Fi driver. Consistent error handling practices like this help maintain stability across subsystems that interact via registration and sysfs.