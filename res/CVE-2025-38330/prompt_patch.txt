1. CVE Identifier
CVE-2025-38330

2. Vulnerability Type
Out-of-bounds memory read due to length-field mismatch

3. Root Cause Summary
In the KUnit test function cs_dsp_ctl_cache_init_multiple_offsets, the coefficient descriptor’s length_bytes was overridden to 8 bytes while allocations were performed based on mock_coeff_template.length_bytes (4 bytes). This mismatch caused subsequent test code to read 8 bytes from buffers sized for 4 bytes, producing an OOB read flagged by KASAN. The patch removes the erroneous override to keep the length consistent with allocation sizes.

4. Kernel Subsystem Analysis
1) Affected Subsystem:
firmware: cs_dsp (KUnit test code for control cache)

2) Pre-Patch Flaw:
The test sets def.length_bytes = 8, diverging from the 4-byte size used for register value allocations derived from mock_coeff_template.length_bytes. No reallocation or validation accompanies the increase, leaving accessors to use 8-byte operations against 4-byte buffers.

3) Trigger Condition:
Running cs_dsp_ctl_cache_init_multiple_offsets with the overridden length while constructing controls and accessing their register values. KASAN detects an OOB read when the test attempts to process 8 bytes from buffers allocated for 4 bytes.

4) Impact Mechanism:
Read operations go past the end of the allocated 4-byte buffer due to the 8-byte length assumption, resulting in out-of-bounds memory reads and KASAN reports; in test context, this can cause failures or potential data exposure from adjacent memory.

5. Patch Analysis
1) Fix Approach:
Maintain consistent length by removing the override so that length_bytes stays at the original 4 bytes for both allocation and subsequent access.

2) Key Code Changes:
Deleted the line “def.length_bytes = 8;” within cs_dsp_ctl_cache_init_multiple_offsets; no other logic was altered.

3) Locking/Concurrency Impact:
None; the change is a size-field correction in a KUnit test path with no locking or concurrency implications.

6. Broader Kernel Security Implications
This patch eliminates a false-positive KASAN OOB read caused by the test itself, improving test reliability and accuracy of memory-safety diagnostics. It underscores the need for strict consistency between descriptor length fields and the sizes used for allocations in cs_dsp-related code. Preventing such mismatches in test and production paths reduces the risk of real buffer overreads, potential information disclosure, and stability issues in the firmware DSP subsystem.