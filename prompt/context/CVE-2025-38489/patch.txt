    @@ -566,7 +566,15 @@ static void bpf_jit_plt(struct bpf_plt *plt, void *ret, void *target)
     {
     	memcpy(plt, &bpf_plt, sizeof(*plt));
     	plt->ret = ret;
    -	plt->target = target;
    +	/*
    +	 * (target == NULL) implies that the branch to this PLT entry was
    +	 * patched and became a no-op. However, some CPU could have jumped
    +	 * to this PLT entry before patching and may be still executing it.
    +	 *
    +	 * Since the intention in this case is to make the PLT entry a no-op,
    +	 * make the target point to the return label instead of NULL.
    +	 */
    +	plt->target = target ?: ret;
     }
     
     /*