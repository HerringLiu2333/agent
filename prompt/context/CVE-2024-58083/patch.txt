 diff --git a/include/linux/kvm_host.h b/include/linux/kvm_host.h
 index 85fe9d0ebb9152…2c66ca21801c17 100644
 — a/include/linux/kvm_host.h
 +++ b/include/linux/kvm_host.h
 @@ -969,6 +969,15 @@ static inline struct kvm_io_bus *kvm_get_bus(struct kvm *kvm, enum kvm_bus idx)
 static inline struct kvm_vcpu *kvm_get_vcpu(struct kvm kvm, int i)
 {
 int num_vcpus = atomic_read(&kvm->online_vcpus);
 +
 + /*
 +  * Explicitly verify the target vCPU is online, as the anti-speculation
 +  * logic only limits the CPU’s ability to speculate, e.g. given a “bad”
 +  * index, clamping the index to 0 would return vCPU0, not NULL.
 +  /
 + if (i >= num_vcpus)
 + return NULL;
 +
 i = array_index_nospec(i, num_vcpus);

 /* Pairs with smp_wmb() in kvm_vm_ioctl_create_vcpu. /