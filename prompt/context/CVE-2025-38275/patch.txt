     @@ -2106,12 +2106,16 @@ static void __iomem *qmp_usb_iomap(struct device *dev, struct device_node *np,
     					int index, bool exclusive)
     {
     	struct resource res;
    +	void __iomem *mem;
     
     	if (!exclusive) {
     		if (of_address_to_resource(np, index, &res))
     			return IOMEM_ERR_PTR(-EINVAL);
     
    -		return devm_ioremap(dev, res.start, resource_size(&res));
    +		mem = devm_ioremap(dev, res.start, resource_size(&res));
    +		if (!mem)
    +			return IOMEM_ERR_PTR(-ENOMEM);
    +		return mem;
     	}
     
     	return devm_of_iomap(dev, np, index, NULL);