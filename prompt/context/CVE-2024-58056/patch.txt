 diff --git a/drivers/remoteproc/remoteproc_core.c b/drivers/remoteproc/remoteproc_core.c
 index f276956f2c5cecâ€¦ef6febe3563307 100644
 --- a/drivers/remoteproc/remoteproc_core.c
 +++ b/drivers/remoteproc/remoteproc_core.c
 @@ -2486,6 +2486,13 @@ struct rproc *rproc_alloc(struct device *dev, const char name,
   rproc->dev.driver_data = rproc;
   idr_init(&rproc->notifyids);

 + /* Assign a unique device index and name /
 + rproc->index = ida_alloc(&rproc_dev_index, GFP_KERNEL);
 + if (rproc->index < 0) {
 + dev_err(dev, "ida_alloc failed: %d\n", rproc->index);
 + goto put_device;
 + }
 +
   rproc->name = kstrdup_const(name, GFP_KERNEL);
   if (!rproc->name)
   goto put_device;
 @@ -2496,13 +2503,6 @@ struct rproc *rproc_alloc(struct device *dev, const char name,
   if (rproc_alloc_ops(rproc, ops))
   goto put_device;

 - /* Assign a unique device index and name /
 - rproc->index = ida_alloc(&rproc_dev_index, GFP_KERNEL);
 - if (rproc->index < 0) {
 - dev_err(dev, "ida_alloc failed: %d\n", rproc->index);
 - goto put_device;
 - }
 -
   dev_set_name(&rproc->dev, "remoteproc%d", rproc->index);

   atomic_set(&rproc->power, 0);