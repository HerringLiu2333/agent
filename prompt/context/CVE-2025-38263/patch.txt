    @@ -1732,7 +1732,12 @@ static CLOSURE_CALLBACK(cache_set_unregister)
     			mutex_unlock(&b->write_lock);
     		}
     
    -	if (ca->alloc_thread)
    +	/*
    +	 * If the register_cache_set() call to bch_cache_set_alloc() failed,
    +	 * ca has not been assigned a value and return error.
    +	 * So we need check ca is not NULL during bch_cache_set_unregister().
    +	 *
    +	if (ca && ca->alloc_thread)
     		kthread_stop(ca->alloc_thread);
     
     	if (c->journal.cur) {